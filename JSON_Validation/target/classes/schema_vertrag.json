{
  "$schema": "https://json-schema.org/draft-07/schema",
  "description": "Vertrag Schema Validation",
  "title": "Vertrag API",
  "type": "object",
  "properties": {
    "vertrag": {
      "type": "object",
      "properties": {
        "vertragsId": {
          "type": "string"
        },
        "vertragsart": {
          "type": "string",
          "enum": [
            "BILANZIERUNGSVERTRAG",
            "BUENDELVERTRAG",
            "ENERGIELIEFERVERTRAG",
            "MESSSTELLENBETRIEBSVERTRAG",
            "NETZNUTZUNGSVERTRAG"
          ],
          "default": "ENERGIELIEFERVERTRAG"
        },
        "sparte": {
          "type": "string",
          "enum": [
            "STROM",
            "GAS",
            "ABWASSER",
            "FERNWAERME",
            "NAHWAERME",
            "STROM_UND_GAS",
            "WASSER"
          ]
        },
        "vertragsabschlussTyp": {
          "type": "string",
          "enum": [
            "Online",
            "Telefon",
            "Empfehlung",
            "D2D"
          ]
        },
        "vertragsabschlussDatum": {
          "type": "string",
          "format": "date"
        },
        "vertragsstatus": {
          "type": "string",
          "enum": [
            "ABGELEHNT",
            "AKTIV",
            "ANGENOMMEN",
            "BEENDET",
            "GEKUENDIGT",
            "IN_ARBEIT",
            "STORNIERT",
            "UEBERMITTELT",
            "WIDERRUFEN"
          ]
        },
        "tarifKennzeichen": {
          "type": "string",
          "enum": [
            "HT",
            "NT",
            ""
          ],
          "default": ""
        },
        "vertriebspartner": {
          "type": "string"
        },
        "vertragspartner": {
          "type": "object",
          "properties": {
            "kundennummer": {
              "type": "string"
            },
            "debitornummer": {
              "type": "string"
            },
            "abschlag": {
              "type": "object",
              "properties": {
                "betrag": {
                  "type": "number",
                  "minimum": 0.0
                },
                "mwStSatz": {
                  "type": "number",
                  "minimum": 0.0,
                  "maximum": 100.0,
                  "default": 19.0
                },
                "waehrung": {
                  "type": "string",
                  "minLength": 3,
                  "default": "EUR"
                },
                "frist": {
                  "type": "string",
                  "enum": [
                    "MONAT",
                    "TAG",
                    "JAHR",
                    "QUARTAL"
                  ],
                  "default": "MONAT"
                },
                "faelligkeitsdatum": {
                  "type": "string",
                  "format": "date"
                }
              },
              "required": [
                "betrag",
                "faelligkeitsdatum"
              ]
            }
          },
          "required": [
            "kundennummer",
            "debitornummer",
            "abschlag"
          ]
        },
        "vertragskonditionen": {
          "type": "object",
          "properties": {
            "kuendigungsfrist": {
              "type": "object",
              "$ref": "#/definitions/zeitraum",
              "required": [
                "einheit"
              ]
            },
            "vertragslaufzeit": {
              "type": "object",
              "$ref": "#/definitions/zeitraum",
              "required": [
                "einheit",
                "startdatum"
              ]
            },
            "vertragsverlaengerung": {
              "type": "object",
              "$ref": "#/definitions/zeitraum",
              "properties": {
                "einheit": {
                  "default": "MONAT"
                }
              }
            }
          },
          "required": [
            "kuendigungsfrist",
            "vertragslaufzeit",
            "vertragsverlaengerung"
          ]
        },
        "verbrauchsstelle": {
          "type": "object",
          "properties": {
            "lieferbeginn": {
              "type": "string",
              "format": "date"
            },
            "objektNummer": {
              "type": "string"
            },
            "netznutzungProduktId": {
              "type": "string"
            },
            "marktlokation": {
              "type": "object",
              "properties": {
                "marktlokationIdent": {
                  "type": "string"
                },
                "netzparameter": {
                  "type": "object",
                  "properties": {
                    "marktgebiet": {
                      "type": "string"
                    },
                    "bilanzKreisKey": {
                      "type": "string"
                    },
                    "netzebene": {
                      "type": "string",
                      "enum": [
                        "Höchstspannungsnetz",
                        "Umspannung",
                        "Hochspannungsnetz",
                        "Umspannung zwischen Hoch- und Mittelspannung",
                        "Mittelspannungsnetz",
                        "Umspannung zwischen Mittel- und Niederspannung",
                        "Niederspannungsnetz"
                      ]
                    },
                    "konzessionsabgabe": {
                      "type": "string"
                    },
                    "verteilnetz": {
                      "type": "object",
                      "properties": {
                        "netzbetreibercodenr": {
                          "type": "string"
                        }
                      },
                      "required": [
                        "netzbetreibercodenr"
                      ]
                    }
                  },
                  "required": [
                    "bilanzKreisKey",
                    "verteilnetz"
                  ]
                }
              },
              "required": [
                "netzparameter"
              ]
            },
            "messlokation": {
              "type": "object",
              "properties": {
                "messlokationsIdent": {
                  "type": "string"
                },
                "lastprofil": {
                  "type": "string"
                },
                "messebene": {
                  "type": "string"
                },
                "zaehler": {
                  "type": "object",
                  "properties": {
                    "geraetenummer": {
                      "type": "string"
                    },
                    "messstellenbetreiber": {
                      "type": "string"
                    }
                  },
                  "required": [
                    "messstellenbetreiber"
                  ]
                }
              },
              "required": [
                "lastprofil"
              ]
            }
          },
          "required": [
            "lieferbeginn",
            "objektNummer",
            "netznutzungProduktId",
            "marktlokation",
            "messlokation"
          ]
        },
        "prognostizierterVerbrauch": {
          "type": "array",
          "minItems": 1,
          "maxItems": 1,
          "items": {
            "type": "object",
            "$ref": "#/definitions/zusatzAttribute",
            "properties": {
              "attribute": {
                "type": "string",
                "enum": [
                  "KWH/JAHR",
                  "HaushaltAnzahl",
                  "HausGroesse in m2"
                ]
              },
              "wert": {
                "type": "number"
              }
            },
            "required": [
              "attribute",
              "wert"
            ]
          }
        },
        "tarif": {
          "type": "object",
          "properties": {
            "produktId": {
              "type": "string"
            }
          },
          "required": [
            "produktId"
          ]
        },
        "vertragSonstigeAttribute": {
          "type": "array",
          "minItems": 3,
          "allOf": [
            {
              "contains": {
                "type": "object",
                "properties": {
                  "attribute": {
                    "type": "string",
                    "const": "abrechnungsgruppen"
                  }
                },
                "required": [
                  "attribute"
                ]
              }
            },
            {
              "contains": {
                "type": "object",
                "properties": {
                  "attribute": {
                    "type": "string",
                    "const": "kundenGruppenSchluessel"
                  }
                },
                "required": [
                  "attribute"
                ]
              }
            },
            {
              "contains": {
                "type": "object",
                "properties": {
                  "attribute": {
                    "type": "string",
                    "const": "prognoseGrundlage"
                  }
                },
                "required": [
                  "attribute"
                ]
              }
            }
          ],
          "uniqueItems": true,
          "items": {
            "$ref": "#/definitions/zusatzAttribute",
            "if": {
              "properties": {
                "attribute": {
                  "const": "abrechnungsgruppen"
                }
              }
            },
            "then": {
              "properties": {
                "wert": {
                  "type": "string",
                  "enum": [
                    "Ablesung 30.01., Abrechnung 14.02.",
                    "Ablesung 28.02., Abrechnung 15.03.",
                    "Ablesung 30.03., Abrechnung 15.04.",
                    "Ablesung 30.04., Abrechnung 15.05.",
                    "Ablesung 30.05., Abrechnung 15.06.",
                    "Ablesung 30.06., Abrechnung 15.07.",
                    "Ablesung 30.07., Abrechnung 15.08.",
                    "Ablesung 30.08., Abrechnung 15.09.",
                    "Ablesung 30.09., Abrechnung 15.10.",
                    "Ablesung 30.10., Abrechnung 15.11.",
                    "Ablesung 30.11., Abrechnung 15.12.",
                    "Ablesung 31.12., Abrechnung 15.01."
                  ]
                }
              }
            },
            "else": {
              "if": {
                "properties": {
                  "attribute": {
                    "const": "prognoseGrundlage"
                  }
                }
              },
              "then": {
                "properties": {
                  "wert": {
                    "type": "string",
                    "enum": [
                      "Werte",
                      "Standardlastprofile",
                      "Standardeinspeiseprofile",
                      "tagesparameterabhängige Lastprofile",
                      "tagesparameterabhängige Einspeiseprofile",
                      "tagesparameterabhängige Einspeiseprofile mit Referenzmessung"
                    ]
                  }
                }
              }
            }
          }
        }
      },
      "required": [
        "sparte",
        "vertragspartner",
        "vertragskonditionen",
        "verbrauchsstelle",
        "prognostizierterVerbrauch",
        "tarif",
        "vertragSonstigeAttribute"
      ]
    }
  },
  "definitions": {
    "zusatzAttribute": {
      "type": "object",
      "properties": {
        "attribute": {
          "type": "string"
        },
        "wert": {
          "type": [
            "string",
            "number"
          ]
        }
      }
    },
    "zeitraum": {
      "type": "object",
      "properties": {
        "dauer": {
          "type": "number"
        },
        "einheit": {
          "type": "string",
          "enum": [
            "WOCHE",
            "TAG",
            "MONAT"
          ]
        },
        "startdatum": {
          "type": "string",
          "format": "date"
        },
        "enddatum": {
          "type": "string",
          "format": "date"
        }
      },
      "required": [
        "dauer"
      ]
    }
  },
  "additionalProperties": false,
  "required": [
    "vertrag"
  ]
}